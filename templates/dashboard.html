<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading System Dashboard</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
        }
        .header {
            background-color: #2c3e50;
            color: white;
            padding: 1rem;
            text-align: center;
        }
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
            padding: 1rem;
        }
        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 1rem;
            margin-bottom: 1rem;
        }
        .metric-card {
            text-align: center;
        }
        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            margin: 0.5rem 0;
        }
        .positive {
            color: #27ae60;
        }
        .negative {
            color: #e74c3c;
        }
        .chart-container {
            height: 300px;
            width: 100%;
        }
        .health-bar {
            height: 20px;
            background-color: #ecf0f1;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .health-fill {
            height: 100%;
            border-radius: 10px;
        }
        .good { background-color: #27ae60; }
        .warning { background-color: #f39c12; }
        .critical { background-color: #e74c3c; }
    </style>
</head>
<body>
    <div class="header">
        <h1>Trading System Dashboard</h1>
        <p>Real-time monitoring and analytics</p>
    </div>

    <div class="dashboard">
        <!-- System Health Metrics -->
        <div class="card">
            <h2>System Health</h2>
            <div class="metric-card">
                <div id="health-score" class="metric-value">95%</div>
                <div class="health-bar">
                    <div id="health-bar-fill" class="health-fill good" style="width: 95%"></div>
                </div>
                <p>Overall System Health</p>
            </div>
        </div>

        <!-- Portfolio Value -->
        <div class="card">
            <h2>Portfolio Value</h2>
            <div class="metric-card">
                <div id="portfolio-value" class="metric-value positive">$130,000</div>
                <p>Total Portfolio Value</p>
            </div>
        </div>

        <!-- Daily P&L -->
        <div class="card">
            <h2>Today's P&L</h2>
            <div class="metric-card">
                <div id="daily-pnl" class="metric-value positive">+$1,250</div>
                <p>Profit and Loss</p>
            </div>
        </div>

        <!-- Active Positions -->
        <div class="card">
            <h2>Active Positions</h2>
            <div class="metric-card">
                <div id="active-positions" class="metric-value">3</div>
                <p>Open Positions</p>
            </div>
        </div>

        <!-- Price Chart -->
        <div class="card">
            <h2>Asset Price</h2>
            <div id="price-chart" class="chart-container"></div>
        </div>

        <!-- P&L Chart -->
        <div class="card">
            <h2>Portfolio P&L</h2>
            <div id="pnl-chart" class="chart-container"></div>
        </div>

        <!-- Latency Chart -->
        <div class="card">
            <h2>System Latency</h2>
            <div id="latency-chart" class="chart-container"></div>
        </div>

        <!-- Resource Usage -->
        <div class="card">
            <h2>Resource Usage</h2>
            <div id="resource-usage">
                <p>CPU: <span id="cpu-percent">45%</span></p>
                <div class="health-bar">
                    <div id="cpu-bar" class="health-fill good" style="width: 45%"></div>
                </div>
                <p>Memory: <span id="memory-percent">35%</span></p>
                <div class="health-bar">
                    <div id="memory-bar" class="health-fill good" style="width: 35%"></div>
                </div>
                <p>Disk: <span id="disk-percent">25%</span></p>
                <div class="health-bar">
                    <div id="disk-bar" class="health-fill good" style="width: 25%"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Function to update system health metrics
        function updateSystemHealth() {
            fetch('/api/system_health')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('health-score').textContent = data.health_score.toFixed(1) + '%';
                    document.getElementById('cpu-percent').textContent = data.cpu_percent.toFixed(1) + '%';
                    document.getElementById('memory-percent').textContent = data.memory_percent.toFixed(1) + '%';
                    document.getElementById('disk-percent').textContent = data.disk_percent.toFixed(1) + '%';
                    
                    // Update health bar colors
                    const healthBar = document.getElementById('health-bar-fill');
                    if (data.health_score > 90) {
                        healthBar.className = 'health-fill good';
                    } else if (data.health_score > 70) {
                        healthBar.className = 'health-fill warning';
                    } else {
                        healthBar.className = 'health-fill critical';
                    }
                    healthBar.style.width = data.health_score + '%';
                    
                    // Update resource bars
                    document.getElementById('cpu-bar').style.width = data.cpu_percent + '%';
                    document.getElementById('memory-bar').style.width = data.memory_percent + '%';
                    document.getElementById('disk-bar').style.width = data.disk_percent + '%';
                })
                .catch(error => console.error('Error fetching system health:', error));
        }

        // Function to update portfolio data
        function updatePortfolioData() {
            fetch('/api/portfolio')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('portfolio-value').textContent = '$' + data.total_value.toLocaleString();
                    document.getElementById('daily-pnl').textContent = '$' + data.daily_pnl.toFixed(2);
                    document.getElementById('active-positions').textContent = data.positions.length;
                    
                    // Update P&L color
                    const pnlElement = document.getElementById('daily-pnl');
                    if (data.daily_pnl >= 0) {
                        pnlElement.className = 'metric-value positive';
                    } else {
                        pnlElement.className = 'metric-value negative';
                    }
                })
                .catch(error => console.error('Error fetching portfolio data:', error));
        }

        // Function to update charts
        function updateCharts() {
            // Update price chart
            fetch('/api/charts/price')
                .then(response => response.json())
                .then(data => Plotly.react('price-chart', data.data, data.layout))
                .catch(error => console.error('Error updating price chart:', error));

            // Update P&L chart
            fetch('/api/charts/pnl')
                .then(response => response.json())
                .then(data => Plotly.react('pnl-chart', data.data, data.layout))
                .catch(error => console.error('Error updating P&L chart:', error));

            // Update latency chart
            fetch('/api/charts/latency')
                .then(response => response.json())
                .then(data => Plotly.react('latency-chart', data.data, data.layout))
                .catch(error => console.error('Error updating latency chart:', error));
        }

        // Initialize dashboard
        function initDashboard() {
            updateSystemHealth();
            updatePortfolioData();
            updateCharts();

            // Update data every 5 seconds
            setInterval(updateSystemHealth, 5000);
            setInterval(updatePortfolioData, 5000);
            setInterval(updateCharts, 10000);
        }

        // Start dashboard when page loads
        window.onload = initDashboard;
    </script>
</body>
</html>