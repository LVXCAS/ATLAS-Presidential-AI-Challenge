<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HIVE TRADE - Bloomberg Terminal Live Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.0.1/dist/chart.umd.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background-color: #000000;
            color: #FFA500;
            font-family: 'Courier New', 'Consolas', monospace;
            font-size: 11px;
            overflow: hidden;
            height: 100vh;
        }
        
        .header {
            background-color: #FFA500;
            color: black;
            padding: 8px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .status-bar {
            background-color: #1a1a1a;
            color: #FFA500;
            padding: 4px 16px;
            font-size: 11px;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 300px 1fr 280px;
            grid-template-rows: 1fr;
            height: calc(100vh - 80px);
            gap: 1px;
            background-color: #333;
        }
        
        .left-panel, .center-panel, .right-panel {
            background-color: #000;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .center-panel {
            display: grid;
            grid-template-rows: 2fr 1fr;
            gap: 1px;
        }
        
        .chart-section {
            background-color: #000;
            border: 1px solid #333;
            position: relative;
        }
        
        .positions-section {
            background-color: #000;
            border: 1px solid #333;
        }
        
        .panel {
            border: 1px solid #444;
            background-color: #111;
        }
        
        .panel-header {
            background-color: #333;
            color: #FFA500;
            padding: 8px;
            font-weight: bold;
            border-bottom: 1px solid #444;
        }
        
        .panel-content {
            padding: 12px;
            height: 300px;
            overflow-y: auto;
        }
        
        .data-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 4px;
            padding: 2px 0;
        }
        
        .positive { color: #00ff00; }
        .negative { color: #ff4444; }
        .neutral { color: #cccccc; }
        
        .blink {
            animation: blink 0.5s linear;
        }
        
        @keyframes blink {
            0%, 50% { background-color: #444400; }
            51%, 100% { background-color: transparent; }
        }
        
        .chart-container {
            height: 200px;
            background: #222;
            border: 1px solid #444;
            margin: 8px 0;
            position: relative;
            display: flex;
            align-items: end;
            padding: 10px;
        }
        
        .chart-bar {
            background: linear-gradient(to top, #FFA500, transparent);
            width: 8px;
            margin: 0 1px;
            transition: height 0.3s ease;
        }
        
        .live-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            background-color: #00ff00;
            border-radius: 50%;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        
        table {
            width: 100%;
            font-size: 11px;
        }
        
        th {
            color: #888;
            text-align: left;
            border-bottom: 1px solid #444;
            padding: 4px 0;
        }
        
        td {
            padding: 2px 0;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div>
            <strong>HIVE TRADE</strong> - LIVE DASHBOARD
        </div>
        <div>
            <span class="live-indicator"></span>
            <span id="current-time"></span>
            <span id="connection-status">CONNECTED</span>
        </div>
    </div>
    
    <!-- Status Bar -->
    <div class="status-bar">
        <span>STATUS: <span id="market-status" class="positive">LIVE</span></span>
        <span>PORTFOLIO: <span id="portfolio-value">$0.00</span></span>
        <span>DAY P&L: <span id="day-pnl">$0.00</span></span>
        <span>POSITIONS: <span id="position-count">0</span></span>
        <span>AGENTS: <span id="agent-status">0/0 ACTIVE</span></span>
        <span>LATENCY: <span id="latency">0ms</span></span>
    </div>
    
    <!-- Main Content -->
    <div class="main-content">
        
        <!-- Portfolio Panel -->
        <div class="panel">
            <div class="panel-header">PORTFOLIO PERFORMANCE</div>
            <div class="panel-content">
                <div id="portfolio-chart" class="chart-container">
                    <!-- Chart bars will be generated here -->
                </div>
                <div class="data-row">
                    <span>Total Value:</span>
                    <span id="total-value" class="neutral">$0.00</span>
                </div>
                <div class="data-row">
                    <span>Total P&L:</span>
                    <span id="total-pnl" class="neutral">$0.00</span>
                </div>
                <div class="data-row">
                    <span>Day P&L:</span>
                    <span id="day-pnl-detail" class="neutral">$0.00</span>
                </div>
            </div>
        </div>
        
        <!-- Positions Panel -->
        <div class="panel">
            <div class="panel-header">CURRENT POSITIONS</div>
            <div class="panel-content">
                <table id="positions-table">
                    <thead>
                        <tr>
                            <th>SYMBOL</th>
                            <th>QTY</th>
                            <th>PRICE</th>
                            <th>P&L</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
        
        <!-- Agents Panel -->
        <div class="panel">
            <div class="panel-header">AI AGENT SIGNALS</div>
            <div class="panel-content" id="agent-signals">
                <!-- Agent signals will be populated here -->
            </div>
        </div>
        
    </div>
    
    <script>
        let liveData = {};
        let chartData = [];
        
        // Update clock
        function updateClock() {
            const now = new Date();
            document.getElementById('current-time').textContent = now.toLocaleTimeString();
        }
        
        // Fetch live data from backend
        async function fetchLiveData() {
            try {
                const response = await fetch('http://localhost:8001/api/dashboard/live-feed');
                if (response.ok) {
                    liveData = await response.json();
                    updateDashboard();
                    document.getElementById('connection-status').textContent = 'CONNECTED';
                } else {
                    document.getElementById('connection-status').textContent = 'ERROR';
                }
            } catch (error) {
                console.error('Failed to fetch data:', error);
                document.getElementById('connection-status').textContent = 'DISCONNECTED';
            }
        }
        
        // Update dashboard with live data
        function updateDashboard() {
            if (!liveData.portfolio) return;
            
            // Update status bar
            document.getElementById('portfolio-value').textContent = 
                '$' + liveData.portfolio.totalValue.toLocaleString('en-US', {minimumFractionDigits: 2});
                
            const dayPnL = liveData.portfolio.dayPnL;
            const dayPnLElement = document.getElementById('day-pnl');
            dayPnLElement.textContent = (dayPnL >= 0 ? '+' : '') + '$' + Math.abs(dayPnL).toLocaleString('en-US', {minimumFractionDigits: 2});
            dayPnLElement.className = dayPnL >= 0 ? 'positive' : 'negative';
            
            document.getElementById('position-count').textContent = liveData.positions ? liveData.positions.length : 0;
            
            const activeAgents = liveData.signals ? liveData.signals.filter(s => s.signal !== 'HOLD').length : 0;
            document.getElementById('agent-status').textContent = activeAgents + '/6 ACTIVE';
            
            document.getElementById('latency').textContent = (liveData.stats?.EXEC_LAT || 0) + 'ms';
            
            // Update portfolio panel
            document.getElementById('total-value').textContent = 
                '$' + liveData.portfolio.totalValue.toLocaleString('en-US', {minimumFractionDigits: 2});
                
            const totalPnL = liveData.portfolio.totalPnL;
            const totalPnLElement = document.getElementById('total-pnl');
            totalPnLElement.textContent = (totalPnL >= 0 ? '+' : '') + '$' + Math.abs(totalPnL).toLocaleString('en-US', {minimumFractionDigits: 2});
            totalPnLElement.className = totalPnL >= 0 ? 'positive' : 'negative';
            
            const dayPnLDetailElement = document.getElementById('day-pnl-detail');
            dayPnLDetailElement.textContent = (dayPnL >= 0 ? '+' : '') + '$' + Math.abs(dayPnL).toLocaleString('en-US', {minimumFractionDigits: 2});
            dayPnLDetailElement.className = dayPnL >= 0 ? 'positive' : 'negative';
            
            // Update portfolio chart
            updatePortfolioChart();
            
            // Update positions table
            updatePositionsTable();
            
            // Update agent signals
            updateAgentSignals();
        }
        
        // Update portfolio chart
        function updatePortfolioChart() {
            if (!liveData.portfolio || !liveData.portfolio.performance) return;
            
            const chartContainer = document.getElementById('portfolio-chart');
            const performance = liveData.portfolio.performance.slice(-20); // Last 20 points
            
            // Clear existing chart
            chartContainer.innerHTML = '';
            
            if (performance.length === 0) return;
            
            const maxValue = Math.max(...performance.map(p => p.portfolio));
            const minValue = Math.min(...performance.map(p => p.portfolio));
            const range = maxValue - minValue || 1;
            
            performance.forEach(point => {
                const bar = document.createElement('div');
                bar.className = 'chart-bar';
                const height = ((point.portfolio - minValue) / range) * 180 + 10; // 10px minimum height
                bar.style.height = height + 'px';
                chartContainer.appendChild(bar);
            });
        }
        
        // Update positions table
        function updatePositionsTable() {
            if (!liveData.positions) return;
            
            const tbody = document.querySelector('#positions-table tbody');
            tbody.innerHTML = '';
            
            liveData.positions.forEach(position => {
                const row = document.createElement('tr');
                const pnlClass = position.pnl >= 0 ? 'positive' : 'negative';
                
                row.innerHTML = `
                    <td><strong>${position.symbol}</strong></td>
                    <td>${position.qty.toLocaleString()}</td>
                    <td>$${position.price.toFixed(2)}</td>
                    <td class="${pnlClass}">${position.pnl >= 0 ? '+' : ''}$${position.pnl.toLocaleString()}</td>
                `;
                
                // Add blink effect for updates
                row.className = 'blink';
                setTimeout(() => row.className = '', 500);
                
                tbody.appendChild(row);
            });
        }
        
        // Update agent signals
        function updateAgentSignals() {
            if (!liveData.signals) return;
            
            const container = document.getElementById('agent-signals');
            container.innerHTML = '';
            
            liveData.signals.forEach(signal => {
                const signalDiv = document.createElement('div');
                signalDiv.style.marginBottom = '12px';
                signalDiv.style.padding = '8px';
                signalDiv.style.border = '1px solid #444';
                
                let signalClass = 'neutral';
                if (signal.signal === 'BUY') signalClass = 'positive';
                else if (signal.signal === 'SELL') signalClass = 'negative';
                
                signalDiv.innerHTML = `
                    <div style="display: flex; justify-content: space-between;">
                        <strong>${signal.agent}</strong>
                        <span class="${signalClass}">${signal.signal}</span>
                    </div>
                    <div style="font-size: 10px; color: #888; margin-top: 4px;">
                        ${signal.symbol} | Size: ${signal.size} | Conf: ${(signal.confidence * 100).toFixed(0)}%
                    </div>
                `;
                
                container.appendChild(signalDiv);
            });
        }
        
        // Initialize dashboard
        function init() {
            updateClock();
            fetchLiveData();
            
            // Update clock every second
            setInterval(updateClock, 1000);
            
            // Fetch live data every 3 seconds
            setInterval(fetchLiveData, 3000);
        }
        
        // Start when page loads
        window.addEventListener('load', init);
    </script>
</body>
</html>