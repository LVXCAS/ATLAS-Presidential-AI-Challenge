<!DOCTYPE html>
<html>
<head>
    <title>HIVE TRADE - Live Dashboard</title>
    <meta charset="UTF-8">
    <style>
        body { 
            background: #000; 
            color: #FFA500; 
            font-family: 'Courier New', monospace; 
            margin: 0; padding: 10px; 
            font-size: 11px;
        }
        .header { 
            background: #FFA500; 
            color: #000; 
            padding: 8px; 
            text-align: center;
            font-weight: bold; 
            margin-bottom: 5px;
        }
        .status { 
            background: #1a1a1a; 
            padding: 8px; 
            margin: 5px 0;
            border: 1px solid #333;
            display: flex;
            justify-content: space-between;
        }
        .panel { 
            background: #111;
            border: 1px solid #333; 
            margin: 10px 0; 
            padding: 0;
        }
        .panel-header {
            background: #333;
            color: #FFA500;
            padding: 5px 8px;
            font-weight: bold;
            border-bottom: 1px solid #444;
        }
        .panel-content {
            padding: 8px;
        }
        .positive { color: #00ff00; }
        .negative { color: #ff4444; }
        .neutral { color: #ccc; }
        .connected { color: #00ff00; }
        .disconnected { color: #ff4444; }
        table { 
            width: 100%; 
            border-collapse: collapse; 
            font-size: 10px;
        }
        td, th { 
            padding: 4px; 
            text-align: left; 
            border-bottom: 1px solid #222;
        }
        th { background: #222; color: #888; }
        .data-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        .signal-item {
            background: #222;
            border: 1px solid #444;
            padding: 5px;
            margin: 3px 0;
            font-size: 9px;
        }
        .signal-buy { border-color: #00ff00; }
        .signal-sell { border-color: #ff4444; }
        .blink { 
            animation: blink 0.3s;
        }
        @keyframes blink {
            0%, 50% { background-color: #444400; }
            51%, 100% { background-color: transparent; }
        }
    </style>
</head>
<body>
    <div class="header">
        HIVE TRADE - BLOOMBERG TERMINAL LIVE SYSTEM v2.1.3
    </div>
    
    <div class="status">
        <span>STATUS: <span id="connection">STARTING...</span></span>
        <span>TIME: <span id="time">--:--:--</span></span>
        <span>PORTFOLIO: <span id="portfolio">$0.00</span></span>
        <span>P&L: <span id="total-pnl">$0.00</span></span>
        <span>POSITIONS: <span id="pos-count">0</span></span>
        <span>AGENTS: <span id="agents">0/0</span></span>
    </div>
    
    <div class="data-grid">
        <div>
            <div class="panel">
                <div class="panel-header">PORTFOLIO PERFORMANCE</div>
                <div class="panel-content">
                    <div>Total Value: <span id="total-value">$0.00</span></div>
                    <div>Total P&L: <span id="total-pnl-detail">$0.00</span></div>
                    <div>Day P&L: <span id="day-pnl">$0.00</span></div>
                    <div style="margin-top: 10px; height: 60px; border: 1px solid #333; background: #0a0a0a; position: relative;">
                        <div id="chart" style="display: flex; align-items: end; height: 100%; padding: 2px;"></div>
                    </div>
                </div>
            </div>
            
            <div class="panel">
                <div class="panel-header">CURRENT POSITIONS</div>
                <div class="panel-content">
                    <table id="positions-table">
                        <thead>
                            <tr><th>SYMBOL</th><th>QTY</th><th>PRICE</th><th>P&L</th><th>%</th></tr>
                        </thead>
                        <tbody>
                            <tr><td colspan="5" class="neutral">Loading...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <div>
            <div class="panel">
                <div class="panel-header">MARKET DATA</div>
                <div class="panel-content">
                    <table id="market-table">
                        <thead>
                            <tr><th>SYMBOL</th><th>LAST</th><th>CHG</th><th>VOL</th></tr>
                        </thead>
                        <tbody>
                            <tr><td colspan="4" class="neutral">Loading...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="panel">
                <div class="panel-header">AI AGENT SIGNALS</div>
                <div class="panel-content">
                    <div id="signals">Loading signals...</div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let connected = false;
        let apiUrl = 'http://localhost:8001/api/dashboard/live-feed';
        
        function updateTime() {
            document.getElementById('time').textContent = new Date().toLocaleTimeString();
        }
        
        function formatMoney(value) {
            return '$' + Math.abs(value).toLocaleString('en-US', {minimumFractionDigits: 2});
        }
        
        function formatChange(value) {
            return (value >= 0 ? '+' : '') + formatMoney(value);
        }
        
        function getColorClass(value) {
            return value >= 0 ? 'positive' : 'negative';
        }
        
        async function fetchData() {
            try {
                const response = await fetch(apiUrl, {
                    method: 'GET',
                    mode: 'cors',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    connected = true;
                    document.getElementById('connection').textContent = 'CONNECTED';
                    document.getElementById('connection').className = 'connected';
                    updateDashboard(data);
                } else {
                    throw new Error('Response not OK: ' + response.status);
                }
            } catch (error) {
                console.error('Fetch error:', error);
                connected = false;
                document.getElementById('connection').textContent = 'DISCONNECTED';
                document.getElementById('connection').className = 'disconnected';
            }
        }
        
        function updateDashboard(data) {
            // Update portfolio summary
            if (data.portfolio) {
                document.getElementById('portfolio').textContent = formatMoney(data.portfolio.totalValue);
                document.getElementById('total-value').textContent = formatMoney(data.portfolio.totalValue);
                
                const totalPnL = data.portfolio.totalPnL || 0;
                const totalPnLEl = document.getElementById('total-pnl');
                totalPnLEl.textContent = formatChange(totalPnL);
                totalPnLEl.className = getColorClass(totalPnL);
                
                const totalPnLDetailEl = document.getElementById('total-pnl-detail');
                totalPnLDetailEl.textContent = formatChange(totalPnL);
                totalPnLDetailEl.className = getColorClass(totalPnL);
                
                const dayPnL = data.portfolio.dayPnL || 0;
                const dayPnLEl = document.getElementById('day-pnl');
                dayPnLEl.textContent = formatChange(dayPnL);
                dayPnLEl.className = getColorClass(dayPnL);
                
                // Simple chart
                updateChart(data.portfolio.performance);
            }
            
            // Update positions
            if (data.positions) {
                document.getElementById('pos-count').textContent = data.positions.length;
                updatePositions(data.positions);
            }
            
            // Update market data
            if (data.market) {
                updateMarket(data.market);
            }
            
            // Update signals
            if (data.signals) {
                const activeCount = data.signals.filter(s => s.signal !== 'HOLD').length;
                document.getElementById('agents').textContent = activeCount + '/6 ACTIVE';
                updateSignals(data.signals);
            }
        }
        
        function updateChart(performance) {
            if (!performance || performance.length === 0) return;
            
            const chart = document.getElementById('chart');
            chart.innerHTML = '';
            
            const recent = performance.slice(-10);
            const max = Math.max(...recent.map(p => p.portfolio));
            const min = Math.min(...recent.map(p => p.portfolio));
            const range = max - min || 1000;
            
            recent.forEach((point, i) => {
                const bar = document.createElement('div');
                bar.style.width = '8px';
                bar.style.margin = '0 1px';
                bar.style.background = 'linear-gradient(to top, #FFA500, #444)';
                bar.style.minHeight = '2px';
                
                const height = ((point.portfolio - min) / range) * 50 + 2;
                bar.style.height = height + 'px';
                bar.title = point.time + ': ' + formatMoney(point.portfolio);
                
                chart.appendChild(bar);
            });
        }
        
        function updatePositions(positions) {
            const tbody = document.querySelector('#positions-table tbody');
            tbody.innerHTML = '';
            
            if (positions.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="neutral">No positions</td></tr>';
                return;
            }
            
            positions.forEach((pos, i) => {
                const row = document.createElement('tr');
                row.className = 'blink';
                setTimeout(() => row.className = '', 500);
                
                row.innerHTML = `
                    <td><strong>${pos.symbol}</strong></td>
                    <td>${pos.qty}</td>
                    <td>$${pos.price.toFixed(2)}</td>
                    <td class="${getColorClass(pos.pnl)}">${formatChange(pos.pnl)}</td>
                    <td class="${getColorClass(pos.pnlPct)}">${pos.pnlPct >= 0 ? '+' : ''}${pos.pnlPct.toFixed(1)}%</td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function updateMarket(market) {
            const tbody = document.querySelector('#market-table tbody');
            tbody.innerHTML = '';
            
            market.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${item.symbol}</strong></td>
                    <td>$${item.last.toFixed(2)}</td>
                    <td class="${getColorClass(item.chg)}">${item.chg >= 0 ? '+' : ''}${item.chg.toFixed(2)}</td>
                    <td>${item.vol}</td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function updateSignals(signals) {
            const container = document.getElementById('signals');
            container.innerHTML = '';
            
            if (signals.length === 0) {
                container.innerHTML = '<div class="neutral">No signals</div>';
                return;
            }
            
            signals.forEach(signal => {
                const div = document.createElement('div');
                div.className = 'signal-item signal-' + signal.signal.toLowerCase();
                
                const signalColor = signal.signal === 'BUY' ? 'positive' : 
                                   signal.signal === 'SELL' ? 'negative' : 'neutral';
                
                div.innerHTML = `
                    <div><strong>${signal.agent}</strong> <span class="${signalColor}">${signal.signal}</span></div>
                    <div>${signal.symbol} | ${signal.size} | ${(signal.confidence * 100).toFixed(0)}%</div>
                `;
                
                container.appendChild(div);
            });
        }
        
        // Initialize
        function init() {
            console.log('HIVE TRADE Dashboard Starting...');
            updateTime();
            fetchData();
            
            setInterval(updateTime, 1000);
            setInterval(fetchData, 2000);
        }
        
        window.onload = init;
    </script>
</body>
</html>