<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HIVE TRADE - Bloomberg Terminal</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background-color: #000000;
            color: #FFA500;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            height: 100vh;
            overflow: hidden;
        }
        
        .header {
            background-color: #FFA500;
            color: #000;
            padding: 6px 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: bold;
            font-size: 12px;
        }
        
        .status-bar {
            background-color: #1a1a1a;
            color: #FFA500;
            padding: 4px 12px;
            font-size: 10px;
            display: flex;
            gap: 20px;
        }
        
        .main-grid {
            display: grid;
            grid-template-columns: 300px 1fr 300px;
            height: calc(100vh - 60px);
            gap: 1px;
            background-color: #333;
        }
        
        .panel {
            background-color: #000;
            border: 1px solid #333;
            display: flex;
            flex-direction: column;
        }
        
        .panel-header {
            background-color: #333;
            color: #FFA500;
            padding: 4px 8px;
            font-weight: bold;
            font-size: 10px;
            border-bottom: 1px solid #444;
        }
        
        .panel-content {
            flex: 1;
            padding: 8px;
            overflow-y: auto;
            font-size: 10px;
        }
        
        .center-panel {
            display: grid;
            grid-template-rows: 2fr 1fr;
            gap: 1px;
        }
        
        .data-row {
            display: flex;
            justify-content: space-between;
            margin: 2px 0;
            padding: 1px 0;
        }
        
        .positive { color: #00ff00; }
        .negative { color: #ff4444; }
        .neutral { color: #cccccc; }
        
        table {
            width: 100%;
            font-size: 9px;
            border-collapse: collapse;
        }
        
        th {
            color: #888;
            text-align: left;
            border-bottom: 1px solid #444;
            padding: 2px 4px;
        }
        
        td {
            padding: 1px 4px;
            border-bottom: 1px solid #222;
        }
        
        .chart-container {
            background: #111;
            border: 1px solid #333;
            position: relative;
            height: 100%;
            display: flex;
            align-items: end;
            padding: 5px;
        }
        
        .chart-bar {
            background: linear-gradient(to top, #FFA500, #444);
            width: 8px;
            margin: 0 1px;
            min-height: 2px;
            transition: height 0.3s ease;
        }
        
        .live-dot {
            display: inline-block;
            width: 8px;
            height: 8px;
            background-color: #00ff00;
            border-radius: 50%;
            animation: pulse 1s infinite;
            margin-right: 5px;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        
        .blink {
            animation: blink 0.5s;
        }
        
        @keyframes blink {
            0%, 50% { background-color: #444400; }
            51%, 100% { background-color: transparent; }
        }
        
        .signal-item {
            margin: 4px 0;
            padding: 4px;
            border: 1px solid #444;
            font-size: 9px;
        }
        
        .signal-buy { border-color: #00ff00; }
        .signal-sell { border-color: #ff4444; }
        .signal-hold { border-color: #888; }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div>
            <strong>HIVE TRADE</strong> - BLOOMBERG TERMINAL v2.1.3
        </div>
        <div>
            <span class="live-dot"></span>
            <span id="current-time"></span>
            <span id="connection-status">CONNECTING...</span>
        </div>
    </div>
    
    <!-- Status Bar -->
    <div class="status-bar">
        <span>STATUS: <span id="market-status" class="positive">LIVE</span></span>
        <span>PORTFOLIO: <span id="portfolio-value">$0.00</span></span>
        <span>DAY P&L: <span id="day-pnl">$0.00</span></span>
        <span>POSITIONS: <span id="position-count">0</span></span>
        <span>AGENTS: <span id="agent-status">0/0 ACTIVE</span></span>
        <span>LATENCY: <span id="latency">0ms</span></span>
    </div>
    
    <!-- Main Content -->
    <div class="main-grid">
        
        <!-- Left Panel - Market Data -->
        <div class="panel">
            <div class="panel-header">MARKET DATA - LIVE</div>
            <div class="panel-content">
                <table id="market-table">
                    <thead>
                        <tr>
                            <th>SYMBOL</th>
                            <th>LAST</th>
                            <th>CHG</th>
                            <th>VOL</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
                
                <div style="margin-top: 20px;">
                    <div class="panel-header" style="background: #222; margin: 0 -8px; padding: 4px 8px;">SYSTEM STATS</div>
                    <div id="system-stats" style="margin-top: 8px;"></div>
                </div>
            </div>
        </div>
        
        <!-- Center Panel - Charts & Positions -->
        <div class="center-panel">
            <!-- Portfolio Chart -->
            <div class="panel">
                <div class="panel-header">PORTFOLIO PERFORMANCE - LIVE INTRADAY</div>
                <div class="panel-content">
                    <div id="portfolio-chart" class="chart-container">
                        <!-- Chart bars will be generated here -->
                    </div>
                    <div style="margin-top: 8px;">
                        <div class="data-row">
                            <span>Total Value:</span>
                            <span id="total-value" class="neutral">$0.00</span>
                        </div>
                        <div class="data-row">
                            <span>Total P&L:</span>
                            <span id="total-pnl" class="neutral">$0.00</span>
                        </div>
                        <div class="data-row">
                            <span>Day P&L:</span>
                            <span id="day-pnl-detail" class="neutral">$0.00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Positions -->
            <div class="panel">
                <div class="panel-header">CURRENT POSITIONS - LIVE P&L</div>
                <div class="panel-content">
                    <table id="positions-table">
                        <thead>
                            <tr>
                                <th>SYMBOL</th>
                                <th>QTY</th>
                                <th>PRICE</th>
                                <th>P&L</th>
                                <th>%</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Right Panel - AI Agents & Risk -->
        <div class="panel">
            <div class="panel-header">AI AGENT SIGNALS - LIVE</div>
            <div class="panel-content">
                <div id="agent-signals">
                    <!-- Agent signals will be populated here -->
                </div>
                
                <div style="margin-top: 20px;">
                    <div class="panel-header" style="background: #222; margin: 0 -8px; padding: 4px 8px;">RISK METRICS</div>
                    <div id="risk-metrics" style="margin-top: 8px;"></div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let liveData = {};
        let isConnected = false;
        
        // Update clock
        function updateClock() {
            const now = new Date();
            document.getElementById('current-time').textContent = now.toLocaleTimeString();
        }
        
        // Fetch live data from backend
        async function fetchLiveData() {
            try {
                const response = await fetch('http://localhost:8001/api/dashboard/live-feed');
                if (response.ok) {
                    liveData = await response.json();
                    isConnected = true;
                    document.getElementById('connection-status').textContent = 'CONNECTED';
                    document.getElementById('connection-status').style.color = '#00ff00';
                    updateDashboard();
                } else {
                    isConnected = false;
                    document.getElementById('connection-status').textContent = 'ERROR';
                    document.getElementById('connection-status').style.color = '#ff4444';
                }
            } catch (error) {
                console.error('Failed to fetch data:', error);
                isConnected = false;
                document.getElementById('connection-status').textContent = 'DISCONNECTED';
                document.getElementById('connection-status').style.color = '#ff4444';
            }
        }
        
        // Format currency
        function formatCurrency(value) {
            return '$' + Math.abs(value).toLocaleString('en-US', {minimumFractionDigits: 2});
        }
        
        // Format change with sign
        function formatChange(value) {
            const sign = value >= 0 ? '+' : '';
            return sign + formatCurrency(value);
        }
        
        // Get color class for P&L
        function getPnLColor(value) {
            return value >= 0 ? 'positive' : 'negative';
        }
        
        // Update dashboard with live data
        function updateDashboard() {
            if (!liveData.portfolio) return;
            
            // Update status bar
            const portfolio = liveData.portfolio;
            document.getElementById('portfolio-value').textContent = formatCurrency(portfolio.totalValue);
            
            const dayPnLElement = document.getElementById('day-pnl');
            dayPnLElement.textContent = formatChange(portfolio.dayPnL);
            dayPnLElement.className = getPnLColor(portfolio.dayPnL);
            
            document.getElementById('position-count').textContent = liveData.positions ? liveData.positions.length : 0;
            
            const activeAgents = liveData.signals ? liveData.signals.filter(s => s.signal !== 'HOLD').length : 0;
            document.getElementById('agent-status').textContent = activeAgents + '/6 ACTIVE';
            
            document.getElementById('latency').textContent = (liveData.stats?.EXEC_LAT || 0).toFixed(1) + 'ms';
            
            // Update portfolio summary
            document.getElementById('total-value').textContent = formatCurrency(portfolio.totalValue);
            
            const totalPnLElement = document.getElementById('total-pnl');
            totalPnLElement.textContent = formatChange(portfolio.totalPnL);
            totalPnLElement.className = getPnLColor(portfolio.totalPnL);
            
            const dayPnLDetailElement = document.getElementById('day-pnl-detail');
            dayPnLDetailElement.textContent = formatChange(portfolio.dayPnL);
            dayPnLDetailElement.className = getPnLColor(portfolio.dayPnL);
            
            // Update portfolio chart
            updatePortfolioChart();
            
            // Update positions table
            updatePositionsTable();
            
            // Update market data
            updateMarketData();
            
            // Update agent signals
            updateAgentSignals();
            
            // Update system stats
            updateSystemStats();
            
            // Update risk metrics
            updateRiskMetrics();
        }
        
        // Update portfolio chart
        function updatePortfolioChart() {
            if (!liveData.portfolio || !liveData.portfolio.performance) return;
            
            const chartContainer = document.getElementById('portfolio-chart');
            const performance = liveData.portfolio.performance.slice(-15); // Last 15 points
            
            // Clear existing chart
            chartContainer.innerHTML = '';
            
            if (performance.length === 0) return;
            
            const maxValue = Math.max(...performance.map(p => p.portfolio));
            const minValue = Math.min(...performance.map(p => p.portfolio));
            const range = maxValue - minValue || 1000;
            
            performance.forEach(point => {
                const bar = document.createElement('div');
                bar.className = 'chart-bar';
                const height = ((point.portfolio - minValue) / range) * 200 + 5; // 5px minimum height
                bar.style.height = height + 'px';
                bar.title = point.time + ': $' + point.portfolio.toLocaleString();
                chartContainer.appendChild(bar);
            });
        }
        
        // Update positions table
        function updatePositionsTable() {
            if (!liveData.positions) return;
            
            const tbody = document.querySelector('#positions-table tbody');
            tbody.innerHTML = '';
            
            liveData.positions.forEach(position => {
                const row = document.createElement('tr');
                const pnlClass = getPnLColor(position.pnl);
                const pnlPctClass = getPnLColor(position.pnlPct);
                
                row.innerHTML = `
                    <td><strong>${position.symbol}</strong></td>
                    <td>${position.qty.toLocaleString()}</td>
                    <td>$${position.price.toFixed(2)}</td>
                    <td class="${pnlClass}">${formatChange(position.pnl)}</td>
                    <td class="${pnlPctClass}">${position.pnlPct >= 0 ? '+' : ''}${position.pnlPct.toFixed(1)}%</td>
                `;
                
                row.className = 'blink';
                setTimeout(() => row.className = '', 300);
                
                tbody.appendChild(row);
            });
        }
        
        // Update market data
        function updateMarketData() {
            if (!liveData.market) return;
            
            const tbody = document.querySelector('#market-table tbody');
            tbody.innerHTML = '';
            
            liveData.market.forEach(item => {
                const row = document.createElement('tr');
                const chgClass = getPnLColor(item.chg);
                
                row.innerHTML = `
                    <td><strong>${item.symbol}</strong></td>
                    <td>$${item.last.toFixed(2)}</td>
                    <td class="${chgClass}">${item.chg >= 0 ? '+' : ''}${item.chg.toFixed(2)}</td>
                    <td>${item.vol}</td>
                `;
                
                tbody.appendChild(row);
            });
        }
        
        // Update agent signals
        function updateAgentSignals() {
            if (!liveData.signals) return;
            
            const container = document.getElementById('agent-signals');
            container.innerHTML = '';
            
            liveData.signals.forEach(signal => {
                const signalDiv = document.createElement('div');
                signalDiv.className = 'signal-item signal-' + signal.signal.toLowerCase();
                
                let signalColor = signal.signal === 'BUY' ? '#00ff00' : 
                                 signal.signal === 'SELL' ? '#ff4444' : '#888';
                
                signalDiv.innerHTML = `
                    <div style="display: flex; justify-content: space-between;">
                        <strong>${signal.agent}</strong>
                        <span style="color: ${signalColor}">${signal.signal}</span>
                    </div>
                    <div style="font-size: 8px; color: #888; margin-top: 2px;">
                        ${signal.symbol} | ${signal.size} @ $${signal.price.toFixed(2)} | ${(signal.confidence * 100).toFixed(0)}%
                    </div>
                `;
                
                container.appendChild(signalDiv);
            });
        }
        
        // Update system stats
        function updateSystemStats() {
            if (!liveData.stats) return;
            
            const container = document.getElementById('system-stats');
            const stats = liveData.stats;
            
            container.innerHTML = `
                <div class="data-row"><span>EXEC_LAT:</span><span>${stats.EXEC_LAT.toFixed(2)}ms</span></div>
                <div class="data-row"><span>SYS_UPTIME:</span><span>${stats.SYS_UPTIME.toFixed(2)}%</span></div>
                <div class="data-row"><span>DATA_FEEDS:</span><span>${stats.DATA_FEEDS}</span></div>
                <div class="data-row"><span>ORDERS_TODAY:</span><span>${stats.ORDERS_TODAY}</span></div>
            `;
        }
        
        // Update risk metrics
        function updateRiskMetrics() {
            if (!liveData.risk) return;
            
            const container = document.getElementById('risk-metrics');
            container.innerHTML = '';
            
            liveData.risk.forEach(risk => {
                const riskDiv = document.createElement('div');
                riskDiv.className = 'data-row';
                riskDiv.style.fontSize = '8px';
                riskDiv.style.marginBottom = '3px';
                
                const valueColor = risk.value < 0 ? '#ff4444' : 
                                  risk.value > risk.limit ? '#00ff00' : '#cccccc';
                
                riskDiv.innerHTML = `
                    <span>${risk.metric}:</span>
                    <span style="color: ${valueColor}">${typeof risk.value === 'number' ? risk.value.toLocaleString() : risk.value}</span>
                `;
                
                container.appendChild(riskDiv);
            });
        }
        
        // Initialize dashboard
        function init() {
            console.log('HIVE TRADE - Bloomberg Terminal Starting...');
            updateClock();
            fetchLiveData();
            
            // Update clock every second
            setInterval(updateClock, 1000);
            
            // Fetch live data every 2 seconds
            setInterval(fetchLiveData, 2000);
        }
        
        // Start when page loads
        window.addEventListener('load', init);
    </script>
</body>
</html>